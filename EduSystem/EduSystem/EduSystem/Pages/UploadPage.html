<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link href="../JS/layui/css/layui.css" rel="stylesheet" />
    <script src="../JS/layui/layui.js"></script>
    <script src="../JS/jquery-3.4.1.min.js"></script>
    <title></title>
</head>
<body>
    <div class="layui-form-item">
        <div class="layui-form-item">
            <form class="layui-form" onsubmit="return false">
                <div class="layui-form-item">
                    <label class="layui-form-label">视频上传:</label>
                    <div class="layui-input-block">
                        <button type="button" class="layui-btn" id="btnUpload">
                            <i class="layui-icon">&#xe67c;</i>上传视频
                        </button>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">视频上传:</label>
                    <div class="layui-input-block">
                        <input id="inputTest" class="layui-input" readonly />
                    </div>
                </div>
                <hr />
                <div class="layui-form-item">
                    <label class="layui-form-label">题目:</label>
                    <div class="layui-input-block">
                        <input id="inputQuestion" class="layui-input" autocomplete="off" />
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">答案A:</label>
                    <div class="layui-input-block">
                        <input id="inputAnswerA" class="layui-input" autocomplete="off" />
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">答案B:</label>
                    <div class="layui-input-block">
                        <input id="inputAnswerB" class="layui-input" autocomplete="off" />
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">答案C:</label>
                    <div class="layui-input-block">
                        <input id="inputAnswerC" class="layui-input" autocomplete="off" />
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">正确答案:</label>
                    <div class="layui-input-block">
                        <select id="rightSelect" name="city" lay-verify="">
                            <option value="010">A</option>
                            <option value="021">B</option>
                            <option value="0571">C</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item" style="text-align:center">
                    <button id="btnUpload" type="button" class="layui-btn layui-btn-warm">提交</button>
                    <button type="reset" class="layui-btn">取消</button>
                </div>
            </form>
        </div>
    </div>
    <script>
        var _videoNo = "";

        layui.use('form', function () {
            var form = layui.form;
            //监听提交
            form.on('submit(formDemo)', function (data) {
                return false;
            });
        });

        layui.use('upload', function () {
            var upload = layui.upload;
            //执行实例
            var uploadInst = upload.render({
                elem: '#btnUpload' //绑定元素
                , accept: 'file'
                , size: 1024 * 20
                , url: '../Ashx/UploadVideoHandler.ashx' //上传接口
                , progress: function (n, elem) {
                    var percent = n + '%' //获取进度百分比
                    element.progress('demo', percent);
                }//可配合 layui 进度条元素使用
                , done: function (res) {
                    _filePath = res.netfilename;
                    layer.msg("上传成功" + res.netfilename);
                    $("#inputTest").val(_filePath);
                    _videoNo = res.newFileName;
                }
                , error: function () {
                    layer.msg('上传失败');
                }
            });
        });

        $(function () {
            $("#btnUpload").click(function () {
                //验证是否有值
                $.ajax({
                    url: "../Ashx/CreateNewQuestionHandler.ashx",
                    type: "post",
                    data: JSON.stringify({ VideoNo: _videoNo, Question: $("#inputQuestion").val(), AnswerA: $("#inputAnswerA").val(), AnswerB: $("#inputAnswerB").val(), AnswerC: $("#inputAnswerC").val(), RightAnswer: $("#rightSelect option:selected").text() }),
                    success: function (msg) {
                        if (msg) {
                            if (msg[0] == "yes") {
                                layer.msg('创建新项目成功');
                            }
                            else {
                                layer.msg('创建新项目失败');
                            }
                        }
                    }
                })
            })
        })
    </script>
</body>
</html>