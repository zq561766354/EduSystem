<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <script src="../JS/jquery-3.4.1.min.js"></script>
    <link href="../CSS/auth.css" rel="stylesheet" />
    <script src="../JS/layui/layui.js"></script>
    <link href="../JS/layui/css/layui.css" rel="stylesheet" />
    <title>Lowin</title>
</head>

<body>
    <div class="lowin lowin-purple">
        <div class="lowin-brand">
            <img src="kodinger.jpg" alt="logo">
        </div>
        <div class="lowin-wrapper">
            <div class="lowin-box lowin-login">
                <div class="lowin-box-inner">
                    <form>
                        <p>登录</p>
                        <div class="lowin-group">
                            <label>手机号 <a href="#" class="login-back-link">Sign in?</a></label>
                            <input id="inputLoginPhone" type="text" autocomplete="off" name="email" class="lowin-input">
                        </div>
                        <div class="lowin-group password-group">
                            <label>密码 <a href="#" class="forgot-link">忘记密码?</a></label>
                            <input id="inputLoginPassword" type="password" name="password" class="lowin-input">
                        </div>
                        <button type="button" id="btnLogin" class="lowin-btn login-btn">
                            登录
                        </button>

                        <div class="text-foot">
                            还没有账号？ <a href="" class="register-link">注册</a>
                        </div>
                    </form>
                </div>
            </div>

            <div class="lowin-box lowin-register">
                <div class="lowin-box-inner">
                    <form>
                        <p>注册账号</p>
                        <div class="lowin-group">
                            <label>姓名</label>
                            <input id="inputName" type="text" name="name" autocomplete="off" class="lowin-input">
                        </div>
                        <div class="lowin-group">
                            <label>手机号</label>
                            <input id="inputPhone" type="text" autocomplete="off" name="email" class="lowin-input">
                        </div>
                        <div class="lowin-group">
                            <label>密码</label>
                            <input id="inputPassword" type="password" name="password" autocomplete="current-password" class="lowin-input">
                        </div>
                        <button type="button" id="btnRegister" class="lowin-btn">
                            注册
                        </button>

                        <div class="text-foot">
                            已有账号？ <a href="" class="login-link">登录</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <footer class="lowin-footer">
            Design By <a href="http://fb.me/itskodinger">@itskodinger</a>
        </footer>
    </div>
    <script src="../JS/auth.js"></script>
    <script>
        Auth.init({
            login_url: '#login',
            forgot_url: '#forgot'
        });
    </script>
    <script>
        layui.use('form', function () {
            var form = layui.form;
            //监听提交
            form.on('submit(formDemo)', function (data) {
                return false;
            });
        });
        function ClearInput() {
            $("#inputName").val("");
            $("#inputPassword").val("");
            $("#inputPhone").val("");
        }

        $(function () {
            $("#btnRegister").click(function () {
                $.ajax({
                    url: "../Ashx/RegisterHandler.ashx",
                    type: "post",
                    data: JSON.stringify({ UserName: $("#inputName").val(), Password: $("#inputPassword").val(), PhoneNumber: $("#inputPhone").val() }),
                    success: function (msg) {
                        if (msg) {
                            if (msg[0] == "yes") {
                                layer.msg('创建新用户成功');
                                ClearInput();
                            }
                            else {
                                layer.msg('创建新用户失败');
                                ClearInput();
                            }
                        }
                    }
                })
            })


            $("#btnLogin").click(function () {
                //登录
                $.ajax({
                    url: "../Ashx/LoginHandler.ashx",
                    type: "post",
                    async: false,
                    data: JSON.stringify({ Password: $("#inputLoginPassword").val(), PhoneNumber: $("#inputLoginPhone").val() }),
                    success: function (msg) {
                        if (msg) {
                            if (msg[0] == "yes") {
                                 window.location.href = "../Pages/MainPage.html?session=" + msg[1];
                            }
                            else {
                                layer.msg('登录失败' + msg[1]);
                                $("#inputLoginPhone").val('登录失败' + msg[1]);
                            }
                        }
                    }
                })
            })
        })
    </script>
</body>
</html>