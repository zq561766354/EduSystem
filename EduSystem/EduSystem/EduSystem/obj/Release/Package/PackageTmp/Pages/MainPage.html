<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>视频课程系统</title>
    <script src="../JS/jquery-3.4.1.min.js"></script>
    <script src="../JS/layui/layui.js"></script>
    <link href="../JS/layui/css/layui.css" rel="stylesheet" />
</head>
<body class="layui-layout-body">
    <div class="layui-layout layui-layout-admin">
        <div class="layui-header">
            <div class="layui-logo">视频课程系统</div>
            <!-- 头部区域（可配合layui已有的水平导航） -->
            <ul class="layui-nav layui-layout-left">
                <li class="layui-nav-item"><a href="UploadPage.html" target="mySrc">视频上传</a></li>
                <li class="layui-nav-item"><a href="">商品管理</a></li>
                <li id="liUser" class="layui-nav-item"><a href="Project/UserControlPage.html" target="mySrc">用户</a></li>
                <li class="layui-nav-item">
                    <a href="javascript:;">其它系统</a>
                    <dl class="layui-nav-child">
                        <dd><a href="">邮件管理</a></dd>
                        <!--<dd><a href="">消息管理</a></dd>
                        <dd><a href="">授权管理</a></dd>-->
                    </dl>
                </li>
            </ul>
            <ul class="layui-nav layui-layout-right">
                <li class="layui-nav-item">
                    <a id="userName" href="javascript:;">
                        贤心
                    </a>
                    <!--<dl class="layui-nav-child">
                      <dd><a href="">基本资料</a></dd>
                      <dd><a href="">安全设置</a></dd>
                    </dl>-->
                </li>
                <li class="layui-nav-item"><a href="../LoginPage/index.html">退出</a></li>
            </ul>
        </div>

        <div class="layui-side layui-bg-black">
            <div class="layui-side-scroll">
                <table class="layui-table" id="VideoTable" lay-filter="VideoTable">
                </table>
            </div>
        </div>

        <div class="layui-body">
            <!-- 内容主体区域 -->
            <div style="padding: 0px;">
                <iframe src=".." style="width:100%;height:800px" id="mySrc" name="mySrc"></iframe>
            </div>
        </div>

        <div class="layui-footer">
            <!-- 底部固定区域 -->
            常熟客运站
            <!--© layui.com - 底部固定区域-->
        </div>
    </div>

    <script>
        //JavaScript代码区域
    </script>
    <script>
        var _data = "";
        var _session = "";
        var _userName = "";
        var _phone = "";
        layui.use('element', function () {
            var element = layui.element;
            _session = GetQueryString("session");
            GetNameAndRank(_session);
            $("#userName").text(_userName);
            ReloadTable();
            //…
        });
    </script>
    <script>
        function GetNameAndRank(_session) {
            $.ajax({
                url: "../Ashx/GetUserNameBySessionHandler.ashx",
                type: "post",
                data: JSON.stringify({ Session: _session }),
                async: false,
                success: function (msg) {
                    if (msg) {
                        _userName = msg.username;
                        _phone = msg.phone;
                    }
                }
            })
        }

        function GetQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]); return null;
        }
    </script>
    <script>
        function ReloadTable() {
            GetVideoInfo();
            layui.use('table', function () {
                var table = layui.table;
                table.render({
                    elem: '#VideoTable'
                    , height: 750
                    , page: false
                    , cols: [[
                        { type: 'numbers', title: '序号', width: 30, fixed: 'left' },
                        { field: 'VideoNo', title: '视频名', width: 110, align: 'center', templet: proofPicture }
                        , { field: 'Statement', title: '观看', width: 60, align: 'center', templet: ChangeColor }
                    ]]
                    , data: _data
                    , limits: [3, 8, 10]
                    , limit: 8
                });
            });
        }

        function ChangeColor(d) {
            var _statement = d.Statement;
            var _videoName = d.VideoNo;
            if (_statement == "否") {
                return '<font color="#FF0000">' + _statement + '</font>'
            } else {
                return '<font color="#000000">' + _statement + '</font>'
            }
        }

        function proofPicture(d) {
            var proofPicture = d.VideoNo;
            if ('' == proofPicture || null == proofPicture || undefined == proofPicture) {
                return '';
            }
            if (proofPicture.length > 0) {
                return '<a class="layui-blue" href="ShowVideoPage.html?phone=' + _phone + '&VideoNo=' + proofPicture + '" target="mySrc">' + proofPicture + '</a>'
            }
        }


        function GetVideoInfo() {
            $.ajax({
                url: "../Ashx/GetVideoTableByPhoneHandler.ashx",
                type: "post",
                data: JSON.stringify({ PhoneNumber: _phone }),
                async: false,
                success: function (msg) {
                    if (msg) {
                        _data = msg.data;
                    }
                }
            })
        }
    </script>
</body>
</html>
